<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Lerninhalte</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #f4f4f4; }
    header {
      background: #1e90ff;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    nav {
      background: #333;
      display: flex;
      gap: 1rem;
      padding: 0.5rem 1rem;
      overflow-x: auto;
    }
    nav button {
      background: none;
      color: white;
      border: none;
      font-size: 1rem;
      cursor: pointer;
      padding: 0.5rem 1rem;
    }
    nav button:hover, nav button.active {
      background: #555;
      border-radius: 5px;
    }
    main {
      padding: 1rem;
    }
    h2 { margin-top: 2rem; }
    iframe {
      width: 100%;
      height: 400px;
      border: 1px solid #ccc;
      margin-bottom: 2rem;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="seitentitel">Lade Klasse...</h1>
  </header>
  <nav id="fächerNav">Lade Fächer...</nav>
  <main id="inhalteContainer"></main>

  <script>
    const params = new URLSearchParams(location.search);
    const xmlPfad = params.get("inhalte");

    async function ladeFächerUndNav() {
      if (!xmlPfad) return;

      const res = await fetch(xmlPfad);
      const xmlText = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "text/xml");

      const klasseName = xml.documentElement.getAttribute("name");
      document.getElementById("seitentitel").textContent = klasseName || "Lerninhalte";

      const fächer = Array.from(xml.getElementsByTagName("fach"));
      const nav = document.getElementById("fächerNav");
      nav.innerHTML = "";

      fächer.forEach((fach, index) => {
        const name = fach.getAttribute("name");
        const pfad = fach.getAttribute("pfad");

        const button = document.createElement("button");
        button.textContent = name;
        if (index === 0) button.classList.add("active");

        button.onclick = () => {
          document.querySelectorAll("nav button").forEach(btn => btn.classList.remove("active"));
          button.classList.add("active");
          ladeAbschnitte(pfad, name);
        };

        nav.appendChild(button);

        if (index === 0) ladeAbschnitte(pfad, name); // Lade erstes Fach direkt
      });
    }

    async function ladeAbschnitte(pfad, fachname) {
      const res = await fetch(pfad);
      const xmlText = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "text/xml");

      const abschnitte = xml.getElementsByTagName("abschnitt");
      const container = document.getElementById("inhalteContainer");
      container.innerHTML = `<h2>${fachname}</h2>`;

      for (let abschnitt of abschnitte) {
        const titel = abschnitt.getAttribute("titel");
        const datei = abschnitt.getAttribute("datei");
        const base = pfad.substring(0, pfad.lastIndexOf("/") + 1);

        const section = document.createElement("section");
        const h3 = document.createElement("h3");
        h3.textContent = titel;
        const iframe = document.createElement("iframe");
        iframe.src = base + datei;

        section.appendChild(h3);
        section.appendChild(iframe);
        container.appendChild(section);
      }
    }

    ladeFächerUndNav();
  </script>
</body>
</html>
